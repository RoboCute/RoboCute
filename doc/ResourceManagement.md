# RoboCute 资源管理系统设计

## 概述

RoboCute资源管理系统是一个**Python-First、多线程、异步加载**的资源管理架构,用于支持Python Server与C++ Editor之间的资源同步。核心设计原则:

1. **Python为权威数据源**: 所有资源的生命周期由Python端管理
2. **异步加载**: 资源加载在后台线程进行,不阻塞主循环
3. **增量同步**: Server-Editor之间仅传输必要的资源元数据
4. **C++加速**: 资源的I/O密集型操作(解析、解码)在C++扩展中实现
5. **统一资源系统**: 不依赖DCC工具,使用自定义资源格式

---

## 系统架构

### 整体架构图




```
┌────────────────────────────────────────────────────────────────┐
│                      Python Server (Main Thread)               │
│  ┌──────────────────────────────────────────────────────────┐  │
│  │              ResourceManager (Python)                    │  │
│  │  - 资源注册表 (Registry)                                  │  │
│  │  - 资源句柄管理 (Handle Management)                       │  │
│  │  - 请求队列管理 (Request Queue)                           │  │
│  │  - 生命周期管理 (Lifecycle)                               │  │
│  └──────────────────────────────────────────────────────────┘  │
│                          ↓ enqueue                             │
│  ┌──────────────────────────────────────────────────────────┐  │
│  │           ResourceRequestQueue (Thread-Safe)             │  │
│  │  - 多生产者单消费者队列                                    │  │
│  │  - 优先级支持                                             │  │
│  └──────────────────────────────────────────────────────────┘  │
│                          ↓                                     │
└────────────────────────────────────────────────────────────────┘
                           ↓ dequeue (background thread)
┌────────────────────────────────────────────────────────────────┐
│                   C++ Extension (Worker Thread)                │
│  ┌──────────────────────────────────────────────────────────┐  │
│  │           AsyncResourceLoader (C++)                      │  │
│  │  - I/O 线程池                                             │  │
│  │  - 资源解析器 (Mesh/Texture/Material)                     │  │
│  │  - GPU上传队列                                            │  │
│  └──────────────────────────────────────────────────────────┘  │
│                          ↓ completed                           │
│  ┌──────────────────────────────────────────────────────────┐  │
│  │           ResourceStorage (C++)                          │  │
│  │  - 内存池管理                                               │  │
│  │  - GPU资源管理                                              │  │
│  │  - LRU缓存策略                                              │  │
│  └──────────────────────────────────────────────────────────┘  │
└────────────────────────────────────────────────────────────────┘
                           ↓ sync (optional)
┌────────────────────────────────────────────────────────────────┐
│                    C++ Editor (Optional)                       │
│  ┌──────────────────────────────────────────────────────────┐  │
│  │           EditorResourceCache (C++)                      │  │
│  │  - 按需加载 (On-Demand)                                    │  │
│  │  - 本地缓存                                                 │  │
│  │  - 资源代理 (Proxy)                                        │  │
│  └──────────────────────────────────────────────────────────┘  │
└────────────────────────────────────────────────────────────────┘
```
